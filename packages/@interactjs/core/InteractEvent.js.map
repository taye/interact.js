{"version":3,"file":"InteractEvent.js","sources":["InteractEvent.ts"],"sourcesContent":["import extend from '@interactjs/utils/extend'\nimport getOriginXY from '@interactjs/utils/getOriginXY'\nimport hypot from '@interactjs/utils/hypot'\n\nimport type { Point, FullRect, PointerEventType, Element, ActionName } from '@interactjs/core/types'\n\nimport { BaseEvent } from './BaseEvent'\nimport type { Interaction } from './Interaction'\nimport { defaults } from './options'\n\nexport type EventPhase = keyof PhaseMap\n\nexport interface PhaseMap {\n  start: true\n  move: true\n  end: true\n}\n\n// defined outside of class definition to avoid assignment of undefined during\n// construction\nexport interface InteractEvent {\n  pageX: number\n  pageY: number\n\n  clientX: number\n  clientY: number\n\n  dx: number\n  dy: number\n\n  velocityX: number\n  velocityY: number\n}\n\nexport class InteractEvent<\n  T extends ActionName = never,\n  P extends EventPhase = EventPhase,\n> extends BaseEvent<T> {\n  declare target: Element\n  declare currentTarget: Element\n  relatedTarget: Element | null = null\n  screenX?: number\n  screenY?: number\n  button: number\n  buttons: number\n  ctrlKey: boolean\n  shiftKey: boolean\n  altKey: boolean\n  metaKey: boolean\n  page: Point\n  client: Point\n  delta: Point\n  rect: FullRect\n  x0: number\n  y0: number\n  t0: number\n  dt: number\n  duration: number\n  clientX0: number\n  clientY0: number\n  velocity: Point\n  speed: number\n  swipe: ReturnType<InteractEvent<T>['getSwipe']>\n  // resize\n  axes?: 'x' | 'y' | 'xy'\n  /** @internal */\n  preEnd?: boolean\n\n  constructor(\n    interaction: Interaction<T>,\n    event: PointerEventType,\n    actionName: T,\n    phase: P,\n    element: Element,\n    preEnd?: boolean,\n    type?: string,\n  ) {\n    super(interaction)\n\n    element = element || interaction.element\n\n    const target = interaction.interactable\n    const deltaSource = (((target && target.options) || defaults) as any).deltaSource as 'page' | 'client'\n    const origin = getOriginXY(target, element, actionName)\n    const starting = phase === 'start'\n    const ending = phase === 'end'\n    const prevEvent = starting ? this : interaction.prevEvent\n    const coords = starting\n      ? interaction.coords.start\n      : ending\n        ? { page: prevEvent.page, client: prevEvent.client, timeStamp: interaction.coords.cur.timeStamp }\n        : interaction.coords.cur\n\n    this.page = extend({}, coords.page)\n    this.client = extend({}, coords.client)\n    this.rect = extend({}, interaction.rect)\n    this.timeStamp = coords.timeStamp\n\n    if (!ending) {\n      this.page.x -= origin.x\n      this.page.y -= origin.y\n\n      this.client.x -= origin.x\n      this.client.y -= origin.y\n    }\n\n    this.ctrlKey = event.ctrlKey\n    this.altKey = event.altKey\n    this.shiftKey = event.shiftKey\n    this.metaKey = event.metaKey\n    this.button = (event as MouseEvent).button\n    this.buttons = (event as MouseEvent).buttons\n    this.target = element\n    this.currentTarget = element\n    this.preEnd = preEnd\n    this.type = type || actionName + (phase || '')\n    this.interactable = target\n\n    this.t0 = starting ? interaction.pointers[interaction.pointers.length - 1].downTime : prevEvent.t0\n\n    this.x0 = interaction.coords.start.page.x - origin.x\n    this.y0 = interaction.coords.start.page.y - origin.y\n    this.clientX0 = interaction.coords.start.client.x - origin.x\n    this.clientY0 = interaction.coords.start.client.y - origin.y\n\n    if (starting || ending) {\n      this.delta = { x: 0, y: 0 }\n    } else {\n      this.delta = {\n        x: this[deltaSource].x - prevEvent[deltaSource].x,\n        y: this[deltaSource].y - prevEvent[deltaSource].y,\n      }\n    }\n\n    this.dt = interaction.coords.delta.timeStamp\n    this.duration = this.timeStamp - this.t0\n\n    // velocity and speed in pixels per second\n    this.velocity = extend({}, interaction.coords.velocity[deltaSource])\n    this.speed = hypot(this.velocity.x, this.velocity.y)\n\n    this.swipe = ending || phase === 'inertiastart' ? this.getSwipe() : null\n  }\n\n  getSwipe() {\n    const interaction = this._interaction\n\n    if (interaction.prevEvent.speed < 600 || this.timeStamp - interaction.prevEvent.timeStamp > 150) {\n      return null\n    }\n\n    let angle = (180 * Math.atan2(interaction.prevEvent.velocityY, interaction.prevEvent.velocityX)) / Math.PI\n    const overlap = 22.5\n\n    if (angle < 0) {\n      angle += 360\n    }\n\n    const left = 135 - overlap <= angle && angle < 225 + overlap\n    const up = 225 - overlap <= angle && angle < 315 + overlap\n\n    const right = !left && (315 - overlap <= angle || angle < 45 + overlap)\n    const down = !up && 45 - overlap <= angle && angle < 135 + overlap\n\n    return {\n      up,\n      down,\n      left,\n      right,\n      angle,\n      speed: interaction.prevEvent.speed,\n      velocity: {\n        x: interaction.prevEvent.velocityX,\n        y: interaction.prevEvent.velocityY,\n      },\n    }\n  }\n\n  preventDefault() {}\n\n  /**\n   * Don't call listeners on the remaining targets\n   */\n  stopImmediatePropagation() {\n    this.immediatePropagationStopped = this.propagationStopped = true\n  }\n\n  /**\n   * Don't call any other listeners (even on the current target)\n   */\n  stopPropagation() {\n    this.propagationStopped = true\n  }\n}\n\n// getters and setters defined here to support typescript 3.6 and below which\n// don't support getter and setters in .d.ts files\nObject.defineProperties(InteractEvent.prototype, {\n  pageX: {\n    get() {\n      return this.page.x\n    },\n    set(value) {\n      this.page.x = value\n    },\n  },\n  pageY: {\n    get() {\n      return this.page.y\n    },\n    set(value) {\n      this.page.y = value\n    },\n  },\n\n  clientX: {\n    get() {\n      return this.client.x\n    },\n    set(value) {\n      this.client.x = value\n    },\n  },\n  clientY: {\n    get() {\n      return this.client.y\n    },\n    set(value) {\n      this.client.y = value\n    },\n  },\n\n  dx: {\n    get() {\n      return this.delta.x\n    },\n    set(value) {\n      this.delta.x = value\n    },\n  },\n  dy: {\n    get() {\n      return this.delta.y\n    },\n    set(value) {\n      this.delta.y = value\n    },\n  },\n\n  velocityX: {\n    get() {\n      return this.velocity.x\n    },\n    set(value) {\n      this.velocity.x = value\n    },\n  },\n  velocityY: {\n    get() {\n      return this.velocity.y\n    },\n    set(value) {\n      this.velocity.y = value\n    },\n  },\n})\n"],"names":["InteractEvent","BaseEvent","relatedTarget","screenX","screenY","button","buttons","ctrlKey","shiftKey","altKey","metaKey","page","client","delta","rect","x0","y0","t0","dt","duration","clientX0","clientY0","velocity","speed","swipe","axes","preEnd","constructor","interaction","event","actionName","phase","element","type","target","interactable","deltaSource","options","defaults","origin","getOriginXY","starting","ending","prevEvent","coords","start","timeStamp","cur","extend","x","y","currentTarget","pointers","length","downTime","hypot","getSwipe","_interaction","angle","Math","atan2","velocityY","velocityX","PI","overlap","left","up","right","down","preventDefault","stopImmediatePropagation","immediatePropagationStopped","propagationStopped","stopPropagation","Object","defineProperties","prototype","pageX","get","set","value","pageY","clientX","clientY","dx","dy"],"mappings":"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"}