{"version":3,"file":"plugin.js","sources":["plugin.ts"],"sourcesContent":["import type Interaction from '@interactjs/core/Interaction'\nimport { _ProxyMethods } from '@interactjs/core/Interaction'\nimport type { Plugin } from '@interactjs/core/scope'\nimport type { Point } from '@interactjs/core/types'\nimport * as rectUtils from '@interactjs/utils/rect'\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    offsetBy?: typeof offsetBy\n    offset: {\n      total: Point\n      pending: Point\n    }\n  }\n\n  enum _ProxyMethods {\n    offsetBy = '',\n  }\n}\n\n;(_ProxyMethods as any).offsetBy = ''\n\nexport function addTotal(interaction: Interaction) {\n  if (!interaction.pointerIsDown) {\n    return\n  }\n\n  addToCoords(interaction.coords.cur, interaction.offset.total)\n\n  interaction.offset.pending.x = 0\n  interaction.offset.pending.y = 0\n}\n\nfunction beforeAction({ interaction }: { interaction: Interaction }) {\n  applyPending(interaction)\n}\n\nfunction beforeEnd({ interaction }: { interaction: Interaction }): boolean | void {\n  const hadPending = applyPending(interaction)\n\n  if (!hadPending) return\n\n  interaction.move({ offset: true })\n  interaction.end()\n\n  return false\n}\n\nfunction end({ interaction }: { interaction: Interaction }) {\n  interaction.offset.total.x = 0\n  interaction.offset.total.y = 0\n  interaction.offset.pending.x = 0\n  interaction.offset.pending.y = 0\n}\n\nexport function applyPending(interaction: Interaction) {\n  if (!hasPending(interaction)) {\n    return false\n  }\n\n  const { pending } = interaction.offset\n\n  addToCoords(interaction.coords.cur, pending)\n  addToCoords(interaction.coords.delta, pending)\n  rectUtils.addEdges(interaction.edges, interaction.rect, pending)\n\n  pending.x = 0\n  pending.y = 0\n\n  return true\n}\n\nfunction offsetBy(this: Interaction, { x, y }: Point) {\n  this.offset.pending.x += x\n  this.offset.pending.y += y\n\n  this.offset.total.x += x\n  this.offset.total.y += y\n}\n\nfunction addToCoords({ page, client }, { x, y }: Point) {\n  page.x += x\n  page.y += y\n  client.x += x\n  client.y += y\n}\n\nfunction hasPending(interaction: Interaction) {\n  return !!(interaction.offset.pending.x || interaction.offset.pending.y)\n}\n\nconst offset: Plugin = {\n  id: 'offset',\n  before: ['modifiers', 'pointer-events', 'actions', 'inertia'],\n  install(scope) {\n    scope.Interaction.prototype.offsetBy = offsetBy\n  },\n  listeners: {\n    'interactions:new': ({ interaction }) => {\n      interaction.offset = {\n        total: { x: 0, y: 0 },\n        pending: { x: 0, y: 0 },\n      }\n    },\n    'interactions:update-pointer': ({ interaction }) => addTotal(interaction),\n    'interactions:before-action-start': beforeAction,\n    'interactions:before-action-move': beforeAction,\n    'interactions:before-action-end': beforeEnd,\n    'interactions:stop': end,\n  },\n}\n\nexport default offset\n"],"names":["_ProxyMethods","offsetBy","addTotal","interaction","pointerIsDown","addToCoords","coords","cur","offset","total","pending","x","y","beforeAction","_ref","applyPending","beforeEnd","_ref2","hadPending","move","end","_ref3","hasPending","delta","rectUtils","addEdges","edges","rect","_ref4","_ref5","_ref6","page","client","id","before","install","scope","Interaction","prototype","listeners","_ref7","_ref8"],"mappings":"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"}