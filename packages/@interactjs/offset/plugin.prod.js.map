{"version":3,"file":"plugin.prod.js","sources":["plugin.ts"],"sourcesContent":["import type Interaction from '@interactjs/core/Interaction'\nimport { _ProxyMethods } from '@interactjs/core/Interaction'\nimport type { Plugin } from '@interactjs/core/scope'\nimport type { Point } from '@interactjs/core/types'\nimport * as rectUtils from '@interactjs/utils/rect'\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    offsetBy?: typeof offsetBy\n    offset: {\n      total: Point\n      pending: Point\n    }\n  }\n\n  enum _ProxyMethods {\n    offsetBy = '',\n  }\n}\n\n;(_ProxyMethods as any).offsetBy = ''\n\nexport function addTotal(interaction: Interaction) {\n  if (!interaction.pointerIsDown) {\n    return\n  }\n\n  addToCoords(interaction.coords.cur, interaction.offset.total)\n\n  interaction.offset.pending.x = 0\n  interaction.offset.pending.y = 0\n}\n\nfunction beforeAction({ interaction }: { interaction: Interaction }) {\n  applyPending(interaction)\n}\n\nfunction beforeEnd({ interaction }: { interaction: Interaction }): boolean | void {\n  const hadPending = applyPending(interaction)\n\n  if (!hadPending) return\n\n  interaction.move({ offset: true })\n  interaction.end()\n\n  return false\n}\n\nfunction end({ interaction }: { interaction: Interaction }) {\n  interaction.offset.total.x = 0\n  interaction.offset.total.y = 0\n  interaction.offset.pending.x = 0\n  interaction.offset.pending.y = 0\n}\n\nexport function applyPending(interaction: Interaction) {\n  if (!hasPending(interaction)) {\n    return false\n  }\n\n  const { pending } = interaction.offset\n\n  addToCoords(interaction.coords.cur, pending)\n  addToCoords(interaction.coords.delta, pending)\n  rectUtils.addEdges(interaction.edges, interaction.rect, pending)\n\n  pending.x = 0\n  pending.y = 0\n\n  return true\n}\n\nfunction offsetBy(this: Interaction, { x, y }: Point) {\n  this.offset.pending.x += x\n  this.offset.pending.y += y\n\n  this.offset.total.x += x\n  this.offset.total.y += y\n}\n\nfunction addToCoords({ page, client }, { x, y }: Point) {\n  page.x += x\n  page.y += y\n  client.x += x\n  client.y += y\n}\n\nfunction hasPending(interaction: Interaction) {\n  return !!(interaction.offset.pending.x || interaction.offset.pending.y)\n}\n\nconst offset: Plugin = {\n  id: 'offset',\n  before: ['modifiers', 'pointer-events', 'actions', 'inertia'],\n  install(scope) {\n    scope.Interaction.prototype.offsetBy = offsetBy\n  },\n  listeners: {\n    'interactions:new': ({ interaction }) => {\n      interaction.offset = {\n        total: { x: 0, y: 0 },\n        pending: { x: 0, y: 0 },\n      }\n    },\n    'interactions:update-pointer': ({ interaction }) => addTotal(interaction),\n    'interactions:before-action-start': beforeAction,\n    'interactions:before-action-move': beforeAction,\n    'interactions:before-action-end': beforeEnd,\n    'interactions:stop': end,\n  },\n}\n\nexport default offset\n"],"names":["_ProxyMethods","offsetBy","addTotal","interaction","addToCoords","coords","cur","offset","total","pending","x","beforeAction","_ref","applyPending","beforeEnd","_ref2","move","end","_ref3","hasPending","delta","rect","rectUtils","_ref4","y","this","_ref5","_ref6","page","client","id","before","scope","install","prototype","listeners","_ref7","_ref8"],"mappings":";;uGAoBEA,SAAAA,SAAsBC,GAERC,EAASC,gBAGvBC,YAAAD,EAAAE,OAAAC,IAAAH,EAAAI,OAAAC,OAEAJ,EAAYD,OAAWM,UAAQH,EAE/BH,EAAYI,OAAOE,QAAQC,EAAI,EAC/BP,CACF,SAAAQ,aAAAC,GAESD,IAAAA,YAAaR,GAAEA,EAA2CU,aAAAV,GAEnE,SAAAW,UAAAC,GAESD,IAAAA,YAAUX,GAAEA,EACnB,GAD8DU,aAAAV,GAM9DA,OAHAA,EAAea,KAAE,CAEjBb,QAAAA,IAAgCA,EAAEc,OACvB,CAEX,CACF,SAAAA,IAAAC,GAESD,IAAAA,YAAId,GAAEA,EAA2CA,EAAAI,OAAAC,MAAAE,EAAA,EACxDP,EAAYI,OAAOC,MAAME,EAAI,EAC7BP,EAAYI,OAAOC,QAAUE,EAAC,EAC9BP,EAAYI,OAAOE,QAAQC,EAAI,CAC/BP,CACF,SAAAU,aAAAV,GAEgBU,IAAAA,WAAAA,UACTM,EAEL,MAAAV,QAEMA,GAAEA,EAAAA,OAORA,mBAPoBN,EAAkBE,OAAAC,IAAAG,GAEtCL,YAAYD,EAAYE,OAAOC,MAAYG,GAC3CL,UAAAA,SAAYD,EAAmBiB,MAAOX,EAAQY,KAAAZ,GAC9Ca,EAASZ,EAAS,EAElBD,EAAQC,EAAI,GACL,CAEP,CACF,SAAAT,SAAAsB,GAEStB,IAAAA,EAA4BS,EAAAc,EAAEd,GAAGc,EAAUC,YAAAhB,QAAAC,GAAAA,EAClDe,KAAKlB,OAAOE,QAAQC,GAAKA,EACzBe,KAAKlB,OAAOE,SAAae,EAEzBC,KAAKlB,OAAOC,MAAME,GAAKA,CACvB,CACF,SAAAN,YAAAsB,EAAAC,GAEA,IAAAC,KAAqBA,EAAAC,OAAED,GAAMC,GAAQH,EAAEhB,EAAAc,EAAEd,GAAGc,EAAUI,KAAAlB,EACpDkB,EAAKlB,GAAKA,EACVkB,EAAMlB,GAAKA,EACXmB,EAAOnB,GAAKA,EAEd,SAAAS,WAAAhB,GAESgB,SAAAA,EAAWhB,OAAwBM,QAAEC,IAAAP,EAAAI,OAAAE,QAAAe,EAC5C,2BACF,MAAAjB,OAAA,CAEAuB,GAAMvB,SACJuB,OAAY,CAAA,YAAA,iBAAA,UAAA,WACZC,OAAAA,CAAQC,GACRC,EAAQD,YAAOE,UAAAjC,SAAAA,QACb+B,EACDG,UAAA,oBACUC,GACT,IAAAjC,YAAqBA,GAAEA,EAAaA,EAAAI,OAAA,CAClCJ,MAAAA,GACO,EAAIO,EAAG,GAASD,QAAA,KACVC,EAAG,GAAQ,EAEzB,8BAAA2B,GACD,IAAAlC,YAAgCA,GAAEA,EAAa,gBAAAA,EAAA,EAA0B,mCAAAQ,aACzE,+CACA,2CACA,oBAAAM,aAGJf,SAAAW,aAAAN"}