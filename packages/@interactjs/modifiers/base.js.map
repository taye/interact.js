{"version":3,"file":"base.js","sources":["base.ts"],"sourcesContent":["import type { InteractEvent } from '@interactjs/core/InteractEvent'\nimport type Interaction from '@interactjs/core/Interaction'\nimport type { Plugin } from '@interactjs/core/scope'\n\nimport { Modification } from './Modification'\nimport type { Modifier, ModifierModule, ModifierState } from './types'\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    modification?: Modification\n  }\n}\n\ndeclare module '@interactjs/core/InteractEvent' {\n  interface InteractEvent {\n    modifiers?: Array<{\n      name: string\n      [key: string]: any\n    }>\n  }\n}\n\ndeclare module '@interactjs/core/options' {\n  interface PerActionDefaults {\n    modifiers?: Modifier[]\n  }\n}\n\nexport function makeModifier<\n  Defaults extends { enabled?: boolean },\n  State extends ModifierState,\n  Name extends string,\n  Result,\n>(module: ModifierModule<Defaults, State, Result>, name?: Name) {\n  const { defaults } = module\n  const methods = {\n    start: module.start,\n    set: module.set,\n    beforeEnd: module.beforeEnd,\n    stop: module.stop,\n  }\n\n  const modifier = (_options?: Partial<Defaults>) => {\n    const options = (_options || {}) as Defaults\n\n    options.enabled = options.enabled !== false\n\n    // add missing defaults to options\n    for (const prop in defaults) {\n      if (!(prop in options)) {\n        ;(options as any)[prop] = defaults[prop]\n      }\n    }\n\n    const m: Modifier<Defaults, State, Name, Result> = {\n      options,\n      methods,\n      name,\n      enable: () => {\n        options.enabled = true\n        return m\n      },\n      disable: () => {\n        options.enabled = false\n        return m\n      },\n    }\n\n    return m\n  }\n\n  if (name && typeof name === 'string') {\n    // for backwrads compatibility\n    modifier._defaults = defaults\n    modifier._methods = methods\n  }\n\n  return modifier\n}\n\nexport function addEventModifiers({\n  iEvent,\n  interaction,\n}: {\n  iEvent: InteractEvent<any>\n  interaction: Interaction<any>\n}) {\n  const result = interaction.modification!.result\n\n  if (result) {\n    iEvent.modifiers = result.eventProps\n  }\n}\n\nconst modifiersBase: Plugin = {\n  id: 'modifiers/base',\n  before: ['actions'],\n  install: (scope) => {\n    scope.defaults.perAction.modifiers = []\n  },\n  listeners: {\n    'interactions:new': ({ interaction }) => {\n      interaction.modification = new Modification(interaction)\n    },\n\n    'interactions:before-action-start': (arg) => {\n      const { interaction } = arg\n      const modification = arg.interaction.modification!\n\n      modification.start(arg, interaction.coords.start.page)\n      interaction.edges = modification.edges\n      modification.applyToInteraction(arg)\n    },\n\n    'interactions:before-action-move': (arg) => {\n      const { interaction } = arg\n      const { modification } = interaction\n      const ret = modification.setAndApply(arg)\n      interaction.edges = modification.edges\n\n      return ret\n    },\n\n    'interactions:before-action-end': (arg) => {\n      const { interaction } = arg\n      const { modification } = interaction\n      const ret = modification.beforeEnd(arg)\n      interaction.edges = modification.startEdges\n\n      return ret\n    },\n\n    'interactions:action-start': addEventModifiers,\n    'interactions:action-move': addEventModifiers,\n    'interactions:action-end': addEventModifiers,\n\n    'interactions:after-action-start': (arg) => arg.interaction.modification.restoreInteractionCoords(arg),\n    'interactions:after-action-move': (arg) => arg.interaction.modification.restoreInteractionCoords(arg),\n\n    'interactions:stop': (arg) => arg.interaction.modification.stop(arg),\n  },\n}\n\nexport default modifiersBase\n"],"names":["makeModifier","module","name","defaults","methods","start","set","beforeEnd","stop","modifier","_options","options","enabled","prop","m","enable","disable","_defaults","_methods","addEventModifiers","_ref","iEvent","interaction","result","modification","modifiers","eventProps","modifiersBase","id","before","install","scope","perAction","listeners","_ref2","Modification","arg","coords","page","edges","applyToInteraction","ret","setAndApply","startEdges","restoreInteractionCoords"],"mappings":"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"}