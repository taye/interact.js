{"version":3,"file":"holdRepeat.js","sources":["holdRepeat.ts"],"sourcesContent":["import type Interaction from '@interactjs/core/Interaction'\nimport type { ListenerMap, Scope, SignalArgs, Plugin } from '@interactjs/core/scope'\n\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './base'\nimport basePlugin from './base'\n/* eslint-enable import/no-duplicates */\nimport { type PointerEvent } from './PointerEvent'\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    holdIntervalHandle?: any\n  }\n}\n\ndeclare module '@interactjs/pointer-events/PointerEvent' {\n  interface PointerEvent<T extends string = any> {\n    count?: number\n  }\n}\n\ndeclare module '@interactjs/pointer-events/base' {\n  interface PointerEventOptions {\n    holdRepeatInterval?: number\n  }\n}\n\nfunction install(scope: Scope) {\n  scope.usePlugin(basePlugin)\n\n  const { pointerEvents } = scope\n\n  // don't repeat by default\n  pointerEvents.defaults.holdRepeatInterval = 0\n  pointerEvents.types.holdrepeat = scope.actions.phaselessTypes.holdrepeat = true\n}\n\nfunction onNew({ pointerEvent }: { pointerEvent: PointerEvent<any> }) {\n  if (pointerEvent.type !== 'hold') return\n\n  pointerEvent.count = (pointerEvent.count || 0) + 1\n}\n\nfunction onFired(\n  { interaction, pointerEvent, eventTarget, targets }: SignalArgs['pointerEvents:fired'],\n  scope: Scope,\n) {\n  if (pointerEvent.type !== 'hold' || !targets.length) return\n\n  // get the repeat interval from the first eventable\n  const interval = targets[0].eventable.options.holdRepeatInterval\n\n  // don't repeat if the interval is 0 or less\n  if (interval <= 0) return\n\n  // set a timeout to fire the holdrepeat event\n  interaction.holdIntervalHandle = setTimeout(() => {\n    scope.pointerEvents.fire(\n      {\n        interaction,\n        eventTarget,\n        type: 'hold',\n        pointer: pointerEvent,\n        event: pointerEvent,\n      },\n      scope,\n    )\n  }, interval)\n}\n\nfunction endHoldRepeat({ interaction }: { interaction: Interaction }) {\n  // set the interaction's holdStopTime property\n  // to stop further holdRepeat events\n  if (interaction.holdIntervalHandle) {\n    clearInterval(interaction.holdIntervalHandle)\n    interaction.holdIntervalHandle = null\n  }\n}\n\nconst holdRepeat: Plugin = {\n  id: 'pointer-events/holdRepeat',\n  install,\n  listeners: ['move', 'up', 'cancel', 'endall'].reduce(\n    (acc, enderTypes) => {\n      ;(acc as any)[`pointerEvents:${enderTypes}`] = endHoldRepeat\n      return acc\n    },\n    {\n      'pointerEvents:new': onNew,\n      'pointerEvents:fired': onFired,\n    } as ListenerMap,\n  ),\n}\n\nexport default holdRepeat\n"],"names":["install","scope","usePlugin","basePlugin","pointerEvents","defaults","holdRepeatInterval","types","holdrepeat","actions","phaselessTypes","onNew","_ref","pointerEvent","type","count","onFired","_ref2","interaction","eventTarget","targets","length","interval","eventable","options","holdIntervalHandle","setTimeout","fire","pointer","event","endHoldRepeat","_ref3","clearInterval","holdRepeat","id","listeners","reduce","acc","enderTypes"],"mappings":";;;;;;;;;;;;;;;;AAGA;AAwBA,SAASA,OAAOA,CAACC,KAAY,EAAE;AAC7BA,EAAAA,KAAK,CAACC,SAAS,CAACC,aAAU,CAAC,CAAA;EAE3B,MAAM;AAAEC,mBAAAA,eAAAA;AAAc,GAAC,GAAGH,KAAK,CAAA;;AAE/B;AACAG,EAAAA,eAAa,CAACC,QAAQ,CAACC,kBAAkB,GAAG,CAAC,CAAA;AAC7CF,EAAAA,eAAa,CAACG,KAAK,CAACC,UAAU,GAAGP,KAAK,CAACQ,OAAO,CAACC,cAAc,CAACF,UAAU,GAAG,IAAI,CAAA;AACjF,CAAA;AAEA,SAASG,KAAKA,CAAAC,IAAA,EAAwD;EAAA,IAAvD;AAAEC,IAAAA,YAAAA;AAAkD,GAAC,GAAAD,IAAA,CAAA;AAClE,EAAA,IAAIC,YAAY,CAACC,IAAI,KAAK,MAAM,EAAE,OAAA;EAElCD,YAAY,CAACE,KAAK,GAAG,CAACF,YAAY,CAACE,KAAK,IAAI,CAAC,IAAI,CAAC,CAAA;AACpD,CAAA;AAEA,SAASC,OAAOA,CAAAC,KAAA,EAEdhB,KAAY,EACZ;EAAA,IAFA;IAAEiB,WAAW;IAAEL,YAAY;IAAEM,WAAW;AAAEC,IAAAA,OAAAA;AAA2C,GAAC,GAAAH,KAAA,CAAA;EAGtF,IAAIJ,YAAY,CAACC,IAAI,KAAK,MAAM,IAAI,CAACM,OAAO,CAACC,MAAM,EAAE,OAAA;;AAErD;EACA,MAAMC,QAAQ,GAAGF,OAAO,CAAC,CAAC,CAAC,CAACG,SAAS,CAACC,OAAO,CAAClB,kBAAkB,CAAA;;AAEhE;EACA,IAAIgB,QAAQ,IAAI,CAAC,EAAE,OAAA;;AAEnB;AACAJ,EAAAA,WAAW,CAACO,kBAAkB,GAAGC,UAAU,CAAC,MAAM;AAChDzB,IAAAA,KAAK,CAACG,aAAa,CAACuB,IAAI,CACtB;MACET,WAAW;MACXC,WAAW;AACXL,MAAAA,IAAI,EAAE,MAAM;AACZc,MAAAA,OAAO,EAAEf,YAAY;AACrBgB,MAAAA,KAAK,EAAEhB,YAAAA;KACR,EACDZ,KACF,CAAC,CAAA;GACF,EAAEqB,QAAQ,CAAC,CAAA;AACd,CAAA;AAEA,SAASQ,aAAaA,CAAAC,KAAA,EAAgD;EAAA,IAA/C;AAAEb,IAAAA,WAAAA;AAA0C,GAAC,GAAAa,KAAA,CAAA;AAClE;AACA;EACA,IAAIb,WAAW,CAACO,kBAAkB,EAAE;AAClCO,IAAAA,aAAa,CAACd,WAAW,CAACO,kBAAkB,CAAC,CAAA;IAC7CP,WAAW,CAACO,kBAAkB,GAAG,IAAI,CAAA;AACvC,GAAA;AACF,CAAA;AAEA,MAAMQ,UAAkB,GAAG;AACzBC,EAAAA,EAAE,EAAE,2BAA2B;EAC/BlC,OAAO;AACPmC,EAAAA,SAAS,EAAE,CAAC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAACC,MAAM,CAClD,CAACC,GAAG,EAAEC,UAAU,KAAK;AACjBD,IAAAA,GAAG,CAAU,CAAgBC,cAAAA,EAAAA,UAAW,CAAC,CAAA,CAAC,GAAGR,aAAa,CAAA;AAC5D,IAAA,OAAOO,GAAG,CAAA;AACZ,GAAC,EACD;AACE,IAAA,mBAAmB,EAAE1B,KAAK;AAC1B,IAAA,qBAAqB,EAAEK,OAAAA;GAE3B,CAAA;AACF;;;;"}