{"version":3,"file":"pointer.js","sources":["pointer.ts"],"sourcesContent":["import type Interaction from '@interactjs/core/Interaction'\nimport type { RectResolvable, Rect, Point } from '@interactjs/core/types'\nimport extend from '@interactjs/utils/extend'\nimport is from '@interactjs/utils/is'\nimport * as rectUtils from '@interactjs/utils/rect'\n\nimport { makeModifier } from '../base'\nimport type { ModifierArg, ModifierModule, ModifierState } from '../types'\n\nexport interface RestrictOptions {\n  // where to drag over\n  restriction: RectResolvable<[number, number, Interaction]>\n  // what part of self is allowed to drag over\n  elementRect: Rect\n  offset: Rect\n  // restrict just before the end drag\n  endOnly: boolean\n  enabled?: boolean\n}\n\nexport type RestrictState = ModifierState<\n  RestrictOptions,\n  {\n    offset: Rect\n  }\n>\n\nfunction start({ rect, startOffset, state, interaction, pageCoords }: ModifierArg<RestrictState>) {\n  const { options } = state\n  const { elementRect } = options\n  const offset: Rect = extend(\n    {\n      left: 0,\n      top: 0,\n      right: 0,\n      bottom: 0,\n    },\n    options.offset || {},\n  )\n\n  if (rect && elementRect) {\n    const restriction = getRestrictionRect(options.restriction, interaction, pageCoords)\n\n    if (restriction) {\n      const widthDiff = restriction.right - restriction.left - rect.width\n      const heightDiff = restriction.bottom - restriction.top - rect.height\n\n      if (widthDiff < 0) {\n        offset.left += widthDiff\n        offset.right += widthDiff\n      }\n      if (heightDiff < 0) {\n        offset.top += heightDiff\n        offset.bottom += heightDiff\n      }\n    }\n\n    offset.left += startOffset.left - rect.width * elementRect.left\n    offset.top += startOffset.top - rect.height * elementRect.top\n\n    offset.right += startOffset.right - rect.width * (1 - elementRect.right)\n    offset.bottom += startOffset.bottom - rect.height * (1 - elementRect.bottom)\n  }\n\n  state.offset = offset\n}\n\nfunction set({ coords, interaction, state }: ModifierArg<RestrictState>) {\n  const { options, offset } = state\n\n  const restriction = getRestrictionRect(options.restriction, interaction, coords)\n\n  if (!restriction) return\n\n  const rect = rectUtils.xywhToTlbr(restriction)\n\n  coords.x = Math.max(Math.min(rect.right - offset.right, coords.x), rect.left + offset.left)\n  coords.y = Math.max(Math.min(rect.bottom - offset.bottom, coords.y), rect.top + offset.top)\n}\n\nexport function getRestrictionRect(\n  value: RectResolvable<[number, number, Interaction]>,\n  interaction: Interaction,\n  coords?: Point,\n) {\n  if (is.func(value)) {\n    return rectUtils.resolveRectLike(value, interaction.interactable, interaction.element, [\n      coords.x,\n      coords.y,\n      interaction,\n    ])\n  } else {\n    return rectUtils.resolveRectLike(value, interaction.interactable, interaction.element)\n  }\n}\n\nconst defaults: RestrictOptions = {\n  restriction: null,\n  elementRect: null,\n  offset: null,\n  endOnly: false,\n  enabled: false,\n}\n\nconst restrict: ModifierModule<RestrictOptions, RestrictState> = {\n  start,\n  set,\n  defaults,\n}\n\nexport default makeModifier(restrict, 'restrict')\nexport { restrict }\n"],"names":["start","_ref","rect","startOffset","state","interaction","pageCoords","options","elementRect","offset","extend","left","top","right","bottom","restriction","getRestrictionRect","widthDiff","width","heightDiff","height","set","_ref2","coords","rectUtils","xywhToTlbr","x","Math","max","min","y","value","is","func","resolveRectLike","interactable","element","defaults","endOnly","enabled","restrict","makeModifier"],"mappings":"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"}