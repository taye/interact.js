{"version":3,"file":"hold.js","sources":["hold.ts"],"sourcesContent":["import type Interaction from '@interactjs/core/Interaction'\nimport type { Scope, Plugin } from '@interactjs/core/scope'\n\n/* eslint-disable import/no-duplicates -- for typescript module augmentations */\nimport './base'\nimport basePlugin from './base'\n/* eslint-enable */\n\ndeclare module '@interactjs/core/options' {\n  interface PerActionDefaults {\n    hold?: number\n    delay?: number\n  }\n}\n\ndeclare module '@interactjs/core/Interaction' {\n  interface Interaction {\n    autoStartHoldTimer?: any\n  }\n}\n\nfunction install(scope: Scope) {\n  const { defaults } = scope\n\n  scope.usePlugin(basePlugin)\n\n  defaults.perAction.hold = 0\n  defaults.perAction.delay = 0\n}\n\nfunction getHoldDuration(interaction: Interaction) {\n  const actionName = interaction.prepared && interaction.prepared.name\n\n  if (!actionName) {\n    return null\n  }\n\n  const options = interaction.interactable.options\n\n  return options[actionName].hold || options[actionName].delay\n}\n\nconst hold: Plugin = {\n  id: 'auto-start/hold',\n  install,\n  listeners: {\n    'interactions:new': ({ interaction }) => {\n      interaction.autoStartHoldTimer = null\n    },\n\n    'autoStart:prepared': ({ interaction }) => {\n      const hold = getHoldDuration(interaction)\n\n      if (hold > 0) {\n        interaction.autoStartHoldTimer = setTimeout(() => {\n          interaction.start(interaction.prepared, interaction.interactable, interaction.element)\n        }, hold)\n      }\n    },\n\n    'interactions:move': ({ interaction, duplicate }) => {\n      if (interaction.autoStartHoldTimer && interaction.pointerWasMoved && !duplicate) {\n        clearTimeout(interaction.autoStartHoldTimer)\n        interaction.autoStartHoldTimer = null\n      }\n    },\n\n    // prevent regular down->move autoStart\n    'autoStart:before-start': ({ interaction }) => {\n      const holdDuration = getHoldDuration(interaction)\n\n      if (holdDuration > 0) {\n        interaction.prepared.name = null\n      }\n    },\n  },\n  getHoldDuration,\n}\nexport default hold\n"],"names":["install","scope","defaults","usePlugin","basePlugin","perAction","hold","delay","getHoldDuration","interaction","actionName","prepared","name","options","interactable","id","listeners","_ref","autoStartHoldTimer","_ref2","setTimeout","start","element","_ref3","duplicate","pointerWasMoved","clearTimeout","_ref4","holdDuration"],"mappings":";;;;;;;;;;;;;;;AAGA;AAGA;;AAeA,SAASA,OAAOA,CAACC,KAAY,EAAE;EAC7B,MAAM;AAAEC,IAAAA,QAAAA;AAAS,GAAC,GAAGD,KAAK,CAAA;AAE1BA,EAAAA,KAAK,CAACE,SAAS,CAACC,SAAU,CAAC,CAAA;AAE3BF,EAAAA,QAAQ,CAACG,SAAS,CAACC,IAAI,GAAG,CAAC,CAAA;AAC3BJ,EAAAA,QAAQ,CAACG,SAAS,CAACE,KAAK,GAAG,CAAC,CAAA;AAC9B,CAAA;AAEA,SAASC,eAAeA,CAACC,WAAwB,EAAE;EACjD,MAAMC,UAAU,GAAGD,WAAW,CAACE,QAAQ,IAAIF,WAAW,CAACE,QAAQ,CAACC,IAAI,CAAA;EAEpE,IAAI,CAACF,UAAU,EAAE;AACf,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AAEA,EAAA,MAAMG,OAAO,GAAGJ,WAAW,CAACK,YAAY,CAACD,OAAO,CAAA;AAEhD,EAAA,OAAOA,OAAO,CAACH,UAAU,CAAC,CAACJ,IAAI,IAAIO,OAAO,CAACH,UAAU,CAAC,CAACH,KAAK,CAAA;AAC9D,CAAA;AAEA,MAAMD,IAAY,GAAG;AACnBS,EAAAA,EAAE,EAAE,iBAAiB;EACrBf,OAAO;AACPgB,EAAAA,SAAS,EAAE;IACT,kBAAkB,EAAEC,IAAA,IAAqB;MAAA,IAApB;AAAER,QAAAA,WAAAA;AAAY,OAAC,GAAAQ,IAAA,CAAA;MAClCR,WAAW,CAACS,kBAAkB,GAAG,IAAI,CAAA;KACtC;IAED,oBAAoB,EAAEC,KAAA,IAAqB;MAAA,IAApB;AAAEV,QAAAA,WAAAA;AAAY,OAAC,GAAAU,KAAA,CAAA;AACpC,MAAA,MAAMb,IAAI,GAAGE,eAAe,CAACC,WAAW,CAAC,CAAA;MAEzC,IAAIH,IAAI,GAAG,CAAC,EAAE;AACZG,QAAAA,WAAW,CAACS,kBAAkB,GAAGE,UAAU,CAAC,MAAM;AAChDX,UAAAA,WAAW,CAACY,KAAK,CAACZ,WAAW,CAACE,QAAQ,EAAEF,WAAW,CAACK,YAAY,EAAEL,WAAW,CAACa,OAAO,CAAC,CAAA;SACvF,EAAEhB,IAAI,CAAC,CAAA;AACV,OAAA;KACD;IAED,mBAAmB,EAAEiB,KAAA,IAAgC;MAAA,IAA/B;QAAEd,WAAW;AAAEe,QAAAA,SAAAA;AAAU,OAAC,GAAAD,KAAA,CAAA;MAC9C,IAAId,WAAW,CAACS,kBAAkB,IAAIT,WAAW,CAACgB,eAAe,IAAI,CAACD,SAAS,EAAE;AAC/EE,QAAAA,YAAY,CAACjB,WAAW,CAACS,kBAAkB,CAAC,CAAA;QAC5CT,WAAW,CAACS,kBAAkB,GAAG,IAAI,CAAA;AACvC,OAAA;KACD;AAED;IACA,wBAAwB,EAAES,KAAA,IAAqB;MAAA,IAApB;AAAElB,QAAAA,WAAAA;AAAY,OAAC,GAAAkB,KAAA,CAAA;AACxC,MAAA,MAAMC,YAAY,GAAGpB,eAAe,CAACC,WAAW,CAAC,CAAA;MAEjD,IAAImB,YAAY,GAAG,CAAC,EAAE;AACpBnB,QAAAA,WAAW,CAACE,QAAQ,CAACC,IAAI,GAAG,IAAI,CAAA;AAClC,OAAA;AACF,KAAA;GACD;AACDJ,EAAAA,eAAAA;AACF;;;;"}