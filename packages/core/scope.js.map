{
	"version": 3,
	"sources": [
		"scope.ts"
	],
	"names": [
		"domObjects",
		"utils",
		"defaults",
		"Eventable",
		"InteractableBase",
		"InteractableSet",
		"InteractEvent",
		"interactions",
		"win",
		"browser",
		"raf",
		"events",
		"ActionName",
		"createScope",
		"Scope",
		"constructor",
		"Math",
		"floor",
		"random",
		"clone",
		"names",
		"methodDict",
		"eventTypes",
		"list",
		"map",
		"event",
		"removeDocument",
		"target",
		"scope",
		"Interactable",
		"_defaults",
		"set",
		"options",
		"fire",
		"interactable",
		"unset",
		"i",
		"length",
		"interaction",
		"stop",
		"destroy",
		"splice",
		"addListeners",
		"id",
		"listenerMaps",
		"push",
		"name",
		"arg",
		"listener",
		"init",
		"window",
		"initScope",
		"pluginIsInstalled",
		"plugin",
		"_plugins",
		"indexOf",
		"usePlugin",
		"install",
		"listeners",
		"before",
		"index",
		"otherId",
		"addDocument",
		"doc",
		"getDocIndex",
		"getWindow",
		"extend",
		"documents",
		"document",
		"add",
		"onWindowUnload",
		"remove",
		"getDocOptions",
		"docIndex",
		"now",
		"Date"
	],
	"mappings": "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",
	"sourcesContent": [
		"import domObjects from '../utils/domObjects'\nimport * as utils from '../utils/index'\nimport defaults from './defaultOptions'\nimport Eventable from './Eventable'\nimport InteractableBase from './Interactable'\nimport InteractableSet from './InteractableSet'\nimport InteractEvent from './InteractEvent'\nimport interactions from './interactions'\n\nexport interface SignalArgs {\n  'scope:add-document': DocSignalArg\n  'scope:remove-document': DocSignalArg\n  'interactable:unset': { interactable: InteractableBase }\n  'interactable:set': { interactable: InteractableBase, options: Interact.Options }\n  'interactions:destroy': { interaction: Interact.Interaction }\n}\n\nexport type ListenerName = keyof SignalArgs\n\ntype ListenerMap = {\n  [P in ListenerName]?: (arg: SignalArgs[P], scope: Scope, signalName: P) => void | boolean\n}\n\ninterface DocSignalArg {\n  doc: Document\n  window: Window\n  scope: Scope\n  options?: { [index: string]: any }\n}\n\nconst {\n  win,\n  browser,\n  raf,\n  events,\n} = utils\n\nexport enum ActionName {\n}\n\nexport interface Actions {\n  names: ActionName[]\n  methodDict: { [key: string]: string }\n  eventTypes: string[]\n}\n\nexport function createScope () {\n  return new Scope()\n}\n\nexport type Defaults = typeof defaults\n\nexport interface Plugin {\n  [key: string]: any\n  id?: string\n  listeners?: ListenerMap\n  before?: string\n  install? (scope: Scope, options?: any): void\n}\n\nexport class Scope {\n  id = `__interact_scope_${Math.floor(Math.random() * 100)}`\n  listenerMaps: Array<{\n    map: ListenerMap\n    id: string\n  }> = []\n\n  browser = browser\n  events = events\n  utils = utils\n  defaults: Defaults = utils.clone(defaults) as Defaults\n  Eventable = Eventable\n  actions: Actions = {\n    names: [],\n    methodDict: {},\n    eventTypes: [],\n  }\n\n  InteractEvent = InteractEvent\n  Interactable!: typeof InteractableBase\n  interactables = new InteractableSet(this)\n\n  // main window\n  _win!: Window\n\n  // main document\n  document!: Document\n\n  // main window\n  window!: Window\n\n  // all documents being listened to\n  documents: Array<{ doc: Document, options: any }> = []\n\n  _plugins: {\n    list: Plugin[]\n    map: { [id: string]: Plugin }\n  } = {\n    list: [],\n    map: {},\n  }\n\n  constructor () {\n    const scope = this as Scope\n\n    ;(this as { Interactable: typeof InteractableBase }).Interactable = class Interactable extends InteractableBase implements InteractableBase {\n      get _defaults () { return scope.defaults }\n\n      set (options: Interact.Options) {\n        super.set(options)\n\n        scope.fire('interactable:set', {\n          options,\n          interactable: this,\n        })\n\n        return this\n      }\n\n      unset () {\n        super.unset()\n        for (let i = scope.interactions.list.length - 1; i >= 0; i--) {\n          const interaction = scope.interactions.list[i]\n\n          if (interaction.interactable === this) {\n            interaction.stop()\n            scope.fire('interactions:destroy', { interaction })\n            interaction.destroy()\n\n            if (scope.interactions.list.length > 2) {\n              scope.interactions.list.splice(i, 1)\n            }\n          }\n        }\n\n        scope.fire('interactable:unset', { interactable: this })\n      }\n    }\n  }\n\n  addListeners (map: ListenerMap, id?: string) {\n    this.listenerMaps.push({ id, map })\n  }\n\n  fire<T extends ListenerName> (name: T, arg: SignalArgs[T]): void | false {\n    for (const { map: { [name]: listener } } of this.listenerMaps) {\n      if (!!listener && listener(arg as any, this, name as never) === false) {\n        return false\n      }\n    }\n  }\n\n  onWindowUnload = (event: BeforeUnloadEvent) => this.removeDocument(event.target as Document)\n\n  init (window: Window) {\n    return initScope(this, window)\n  }\n\n  pluginIsInstalled (plugin: Plugin) {\n    return this._plugins.map[plugin.id] || this._plugins.list.indexOf(plugin) !== -1\n  }\n\n  usePlugin (plugin: Plugin, options?: { [key: string]: any }) {\n    if (this.pluginIsInstalled(plugin)) {\n      return this\n    }\n\n    if (plugin.id) { this._plugins.map[plugin.id] = plugin }\n    this._plugins.list.push(plugin)\n\n    if (plugin.install) {\n      plugin.install(this, options)\n    }\n\n    if (plugin.listeners && plugin.before) {\n      let index = 0\n\n      for (; index < this.listenerMaps.length; index++) {\n        const otherId = this.listenerMaps[index].id\n\n        if (otherId === plugin.before) { break }\n      }\n\n      this.listenerMaps.splice(index, 0, { id: plugin.id, map: plugin.listeners })\n    }\n    else if (plugin.listeners) {\n      this.listenerMaps.push({ id: plugin.id, map: plugin.listeners })\n    }\n\n    return this\n  }\n\n  addDocument (doc: Document, options?: any): void | false {\n    // do nothing if document is already known\n    if (this.getDocIndex(doc) !== -1) { return false }\n\n    const window = win.getWindow(doc)\n\n    options = options ? utils.extend({}, options) : {}\n\n    this.documents.push({ doc, options })\n    events.documents.push(doc)\n\n    // don't add an unload event for the main document\n    // so that the page may be cached in browser history\n    if (doc !== this.document) {\n      events.add(window, 'unload', this.onWindowUnload)\n    }\n\n    this.fire('scope:add-document', { doc, window, scope: this, options })\n  }\n\n  removeDocument (doc: Document) {\n    const index = this.getDocIndex(doc)\n\n    const window = win.getWindow(doc)\n    const options = this.documents[index].options\n\n    events.remove(window, 'unload', this.onWindowUnload)\n\n    this.documents.splice(index, 1)\n    events.documents.splice(index, 1)\n\n    this.fire('scope:remove-document', { doc, window, scope: this, options })\n  }\n\n  getDocIndex (doc: Document) {\n    for (let i = 0; i < this.documents.length; i++) {\n      if (this.documents[i].doc === doc) {\n        return i\n      }\n    }\n\n    return -1\n  }\n\n  getDocOptions (doc: Document) {\n    const docIndex = this.getDocIndex(doc)\n\n    return docIndex === -1 ? null : this.documents[docIndex].options\n  }\n\n  now () {\n    return ((this.window as any).Date as typeof Date || Date).now()\n  }\n}\n\nexport function initScope (scope: Scope, window: Window) {\n  win.init(window)\n  domObjects.init(window)\n  browser.init(window)\n  raf.init(window)\n  events.init(window)\n\n  scope.usePlugin(interactions)\n  scope.document = window.document\n  scope.window = window\n\n  return scope\n}\n"
	]
}