{"version":3,"file":"aspectRatio.js","sources":["aspectRatio.ts"],"sourcesContent":["/**\n * @module modifiers/aspectRatio\n *\n * @description\n * This modifier forces elements to be resized with a specified dx/dy ratio.\n *\n * ```js\n * interact(target).resizable({\n *   modifiers: [\n *     interact.modifiers.snapSize({\n *       targets: [ interact.snappers.grid({ x: 20, y: 20 }) ],\n *     }),\n *     interact.aspectRatio({ ratio: 'preserve' }),\n *   ],\n * });\n * ```\n */\n\nimport type { Point, Rect, EdgeOptions } from '@interactjs/core/types'\nimport extend from '@interactjs/utils/extend'\nimport { addEdges } from '@interactjs/utils/rect'\n\nimport { makeModifier } from './base'\nimport { Modification } from './Modification'\nimport type { Modifier, ModifierModule, ModifierState } from './types'\n\nexport interface AspectRatioOptions {\n  ratio?: number | 'preserve'\n  equalDelta?: boolean\n  modifiers?: Modifier[]\n  enabled?: boolean\n}\n\nexport type AspectRatioState = ModifierState<\n  AspectRatioOptions,\n  {\n    startCoords: Point\n    startRect: Rect\n    linkedEdges: EdgeOptions\n    ratio: number\n    equalDelta: boolean\n    xIsPrimaryAxis: boolean\n    edgeSign: {\n      x: number\n      y: number\n    }\n    subModification: Modification\n  }\n>\n\nconst aspectRatio: ModifierModule<AspectRatioOptions, AspectRatioState> = {\n  start(arg) {\n    const { state, rect, edges, pageCoords: coords } = arg\n    let { ratio, enabled } = state.options\n    const { equalDelta, modifiers } = state.options\n\n    if (ratio === 'preserve') {\n      ratio = rect.width / rect.height\n    }\n\n    state.startCoords = extend({}, coords)\n    state.startRect = extend({}, rect)\n    state.ratio = ratio\n    state.equalDelta = equalDelta\n\n    const linkedEdges = (state.linkedEdges = {\n      top: edges.top || (edges.left && !edges.bottom),\n      left: edges.left || (edges.top && !edges.right),\n      bottom: edges.bottom || (edges.right && !edges.top),\n      right: edges.right || (edges.bottom && !edges.left),\n    })\n\n    state.xIsPrimaryAxis = !!(edges.left || edges.right)\n\n    if (state.equalDelta) {\n      const sign = (linkedEdges.left ? 1 : -1) * (linkedEdges.top ? 1 : -1)\n      state.edgeSign = {\n        x: sign,\n        y: sign,\n      }\n    } else {\n      state.edgeSign = {\n        x: linkedEdges.left ? -1 : 1,\n        y: linkedEdges.top ? -1 : 1,\n      }\n    }\n\n    if (enabled !== false) {\n      extend(edges, linkedEdges)\n    }\n\n    if (!modifiers?.length) return\n\n    const subModification = new Modification(arg.interaction)\n\n    subModification.copyFrom(arg.interaction.modification)\n    subModification.prepareStates(modifiers)\n\n    state.subModification = subModification\n    subModification.startAll({ ...arg })\n  },\n\n  set(arg) {\n    const { state, rect, coords } = arg\n    const { linkedEdges } = state\n    const initialCoords = extend({}, coords)\n    const aspectMethod = state.equalDelta ? setEqualDelta : setRatio\n\n    extend(arg.edges, linkedEdges)\n    aspectMethod(state, state.xIsPrimaryAxis, coords, rect)\n\n    if (!state.subModification) {\n      return null\n    }\n\n    const correctedRect = extend({}, rect)\n\n    addEdges(linkedEdges, correctedRect, {\n      x: coords.x - initialCoords.x,\n      y: coords.y - initialCoords.y,\n    })\n\n    const result = state.subModification.setAll({\n      ...arg,\n      rect: correctedRect,\n      edges: linkedEdges,\n      pageCoords: coords,\n      prevCoords: coords,\n      prevRect: correctedRect,\n    })\n\n    const { delta } = result\n\n    if (result.changed) {\n      const xIsCriticalAxis = Math.abs(delta.x) > Math.abs(delta.y)\n\n      // do aspect modification again with critical edge axis as primary\n      aspectMethod(state, xIsCriticalAxis, result.coords, result.rect)\n      extend(coords, result.coords)\n    }\n\n    return result.eventProps\n  },\n\n  defaults: {\n    ratio: 'preserve',\n    equalDelta: false,\n    modifiers: [],\n    enabled: false,\n  },\n}\n\nfunction setEqualDelta({ startCoords, edgeSign }: AspectRatioState, xIsPrimaryAxis: boolean, coords: Point) {\n  if (xIsPrimaryAxis) {\n    coords.y = startCoords.y + (coords.x - startCoords.x) * edgeSign.y\n  } else {\n    coords.x = startCoords.x + (coords.y - startCoords.y) * edgeSign.x\n  }\n}\n\nfunction setRatio(\n  { startRect, startCoords, ratio, edgeSign }: AspectRatioState,\n  xIsPrimaryAxis: boolean,\n  coords: Point,\n  rect: Rect,\n) {\n  if (xIsPrimaryAxis) {\n    const newHeight = rect.width / ratio\n\n    coords.y = startCoords.y + (newHeight - startRect.height) * edgeSign.y\n  } else {\n    const newWidth = rect.height * ratio\n\n    coords.x = startCoords.x + (newWidth - startRect.width) * edgeSign.x\n  }\n}\n\nexport default makeModifier(aspectRatio, 'aspectRatio')\nexport { aspectRatio }\n"],"names":["aspectRatio","start","arg","state","rect","edges","pageCoords","coords","ratio","enabled","options","equalDelta","modifiers","width","height","startCoords","extend","startRect","linkedEdges","top","left","bottom","right","xIsPrimaryAxis","sign","edgeSign","x","y","length","subModification","Modification","interaction","copyFrom","modification","prepareStates","startAll","set","initialCoords","aspectMethod","setEqualDelta","setRatio","correctedRect","addEdges","result","setAll","prevCoords","prevRect","delta","changed","xIsCriticalAxis","Math","abs","eventProps","defaults","_ref","_ref2","newHeight","newWidth","makeModifier"],"mappings":"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"}