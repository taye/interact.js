{"version":3,"file":"InteractEvent.prod.js","sources":["InteractEvent.ts"],"sourcesContent":["import extend from '@interactjs/utils/extend'\nimport getOriginXY from '@interactjs/utils/getOriginXY'\nimport hypot from '@interactjs/utils/hypot'\n\nimport type { Point, FullRect, PointerEventType, Element, ActionName } from '@interactjs/core/types'\n\nimport { BaseEvent } from './BaseEvent'\nimport type { Interaction } from './Interaction'\nimport { defaults } from './options'\n\nexport type EventPhase = keyof PhaseMap\n\nexport interface PhaseMap {\n  start: true\n  move: true\n  end: true\n}\n\n// defined outside of class definition to avoid assignment of undefined during\n// construction\nexport interface InteractEvent {\n  pageX: number\n  pageY: number\n\n  clientX: number\n  clientY: number\n\n  dx: number\n  dy: number\n\n  velocityX: number\n  velocityY: number\n}\n\nexport class InteractEvent<\n  T extends ActionName = never,\n  P extends EventPhase = EventPhase,\n> extends BaseEvent<T> {\n  declare target: Element\n  declare currentTarget: Element\n  relatedTarget: Element | null = null\n  screenX?: number\n  screenY?: number\n  button: number\n  buttons: number\n  ctrlKey: boolean\n  shiftKey: boolean\n  altKey: boolean\n  metaKey: boolean\n  page: Point\n  client: Point\n  delta: Point\n  rect: FullRect\n  x0: number\n  y0: number\n  t0: number\n  dt: number\n  duration: number\n  clientX0: number\n  clientY0: number\n  velocity: Point\n  speed: number\n  swipe: ReturnType<InteractEvent<T>['getSwipe']>\n  // resize\n  axes?: 'x' | 'y' | 'xy'\n  /** @internal */\n  preEnd?: boolean\n\n  constructor(\n    interaction: Interaction<T>,\n    event: PointerEventType,\n    actionName: T,\n    phase: P,\n    element: Element,\n    preEnd?: boolean,\n    type?: string,\n  ) {\n    super(interaction)\n\n    element = element || interaction.element\n\n    const target = interaction.interactable\n    const deltaSource = (((target && target.options) || defaults) as any).deltaSource as 'page' | 'client'\n    const origin = getOriginXY(target, element, actionName)\n    const starting = phase === 'start'\n    const ending = phase === 'end'\n    const prevEvent = starting ? this : interaction.prevEvent\n    const coords = starting\n      ? interaction.coords.start\n      : ending\n        ? { page: prevEvent.page, client: prevEvent.client, timeStamp: interaction.coords.cur.timeStamp }\n        : interaction.coords.cur\n\n    this.page = extend({}, coords.page)\n    this.client = extend({}, coords.client)\n    this.rect = extend({}, interaction.rect)\n    this.timeStamp = coords.timeStamp\n\n    if (!ending) {\n      this.page.x -= origin.x\n      this.page.y -= origin.y\n\n      this.client.x -= origin.x\n      this.client.y -= origin.y\n    }\n\n    this.ctrlKey = event.ctrlKey\n    this.altKey = event.altKey\n    this.shiftKey = event.shiftKey\n    this.metaKey = event.metaKey\n    this.button = (event as MouseEvent).button\n    this.buttons = (event as MouseEvent).buttons\n    this.target = element\n    this.currentTarget = element\n    this.preEnd = preEnd\n    this.type = type || actionName + (phase || '')\n    this.interactable = target\n\n    this.t0 = starting ? interaction.pointers[interaction.pointers.length - 1].downTime : prevEvent.t0\n\n    this.x0 = interaction.coords.start.page.x - origin.x\n    this.y0 = interaction.coords.start.page.y - origin.y\n    this.clientX0 = interaction.coords.start.client.x - origin.x\n    this.clientY0 = interaction.coords.start.client.y - origin.y\n\n    if (starting || ending) {\n      this.delta = { x: 0, y: 0 }\n    } else {\n      this.delta = {\n        x: this[deltaSource].x - prevEvent[deltaSource].x,\n        y: this[deltaSource].y - prevEvent[deltaSource].y,\n      }\n    }\n\n    this.dt = interaction.coords.delta.timeStamp\n    this.duration = this.timeStamp - this.t0\n\n    // velocity and speed in pixels per second\n    this.velocity = extend({}, interaction.coords.velocity[deltaSource])\n    this.speed = hypot(this.velocity.x, this.velocity.y)\n\n    this.swipe = ending || phase === 'inertiastart' ? this.getSwipe() : null\n  }\n\n  getSwipe() {\n    const interaction = this._interaction\n\n    if (interaction.prevEvent.speed < 600 || this.timeStamp - interaction.prevEvent.timeStamp > 150) {\n      return null\n    }\n\n    let angle = (180 * Math.atan2(interaction.prevEvent.velocityY, interaction.prevEvent.velocityX)) / Math.PI\n    const overlap = 22.5\n\n    if (angle < 0) {\n      angle += 360\n    }\n\n    const left = 135 - overlap <= angle && angle < 225 + overlap\n    const up = 225 - overlap <= angle && angle < 315 + overlap\n\n    const right = !left && (315 - overlap <= angle || angle < 45 + overlap)\n    const down = !up && 45 - overlap <= angle && angle < 135 + overlap\n\n    return {\n      up,\n      down,\n      left,\n      right,\n      angle,\n      speed: interaction.prevEvent.speed,\n      velocity: {\n        x: interaction.prevEvent.velocityX,\n        y: interaction.prevEvent.velocityY,\n      },\n    }\n  }\n\n  preventDefault() {}\n\n  /**\n   * Don't call listeners on the remaining targets\n   */\n  stopImmediatePropagation() {\n    this.immediatePropagationStopped = this.propagationStopped = true\n  }\n\n  /**\n   * Don't call any other listeners (even on the current target)\n   */\n  stopPropagation() {\n    this.propagationStopped = true\n  }\n}\n\n// getters and setters defined here to support typescript 3.6 and below which\n// don't support getter and setters in .d.ts files\nObject.defineProperties(InteractEvent.prototype, {\n  pageX: {\n    get() {\n      return this.page.x\n    },\n    set(value) {\n      this.page.x = value\n    },\n  },\n  pageY: {\n    get() {\n      return this.page.y\n    },\n    set(value) {\n      this.page.y = value\n    },\n  },\n\n  clientX: {\n    get() {\n      return this.client.x\n    },\n    set(value) {\n      this.client.x = value\n    },\n  },\n  clientY: {\n    get() {\n      return this.client.y\n    },\n    set(value) {\n      this.client.y = value\n    },\n  },\n\n  dx: {\n    get() {\n      return this.delta.x\n    },\n    set(value) {\n      this.delta.x = value\n    },\n  },\n  dy: {\n    get() {\n      return this.delta.y\n    },\n    set(value) {\n      this.delta.y = value\n    },\n  },\n\n  velocityX: {\n    get() {\n      return this.velocity.x\n    },\n    set(value) {\n      this.velocity.x = value\n    },\n  },\n  velocityY: {\n    get() {\n      return this.velocity.y\n    },\n    set(value) {\n      this.velocity.y = value\n    },\n  },\n})\n"],"names":["InteractEvent","BaseEvent","relatedTarget","event","actionName","phase","element","preEnd","type","interaction","screenX","screenY","button","ctrlKey","shiftKey","altKey","metaKey","page","client","this","delta","rect","x0","y0","clientY0","velocity","speed","swipe","axes","target","interactable","deltaSource","options","defaults","origin","getOriginXY","starting","ending","prevEvent","coords","start","timeStamp","cur","extend","x","y","buttons","currentTarget","t0","pointers","length","downTime","clientX0","dt","duration","hypot","getSwipe","_interaction","angle","Math","atan2","velocityY","velocityX","PI","left","up","down","right","preventDefault","stopImmediatePropagation","immediatePropagationStopped","propagationStopped","stopPropagation","Object","defineProperties","prototype","pageX","get","set","value","pageY","clientX","clientY","dx","dy"],"mappings":"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"}