{"version":3,"file":"DropEvent.js","sources":["DropEvent.ts"],"sourcesContent":["import { BaseEvent } from '@interactjs/core/BaseEvent'\nimport type { Interactable } from '@interactjs/core/Interactable'\nimport type { InteractEvent } from '@interactjs/core/InteractEvent'\nimport type { Element } from '@interactjs/core/types'\nimport * as arr from '@interactjs/utils/arr'\n\nimport type { DropState } from './plugin'\n\nexport class DropEvent extends BaseEvent<'drag'> {\n  declare target: Element\n  dropzone: Interactable\n  dragEvent: InteractEvent<'drag'>\n  relatedTarget: Element\n  draggable: Interactable\n  propagationStopped = false\n  immediatePropagationStopped = false\n\n  /**\n   * Class of events fired on dropzones during drags with acceptable targets.\n   */\n  constructor(dropState: DropState, dragEvent: InteractEvent<'drag'>, type: string) {\n    super(dragEvent._interaction)\n\n    const { element, dropzone } = type === 'dragleave' ? dropState.prev : dropState.cur\n\n    this.type = type\n    this.target = element\n    this.currentTarget = element\n    this.dropzone = dropzone\n    this.dragEvent = dragEvent\n    this.relatedTarget = dragEvent.target\n    this.draggable = dragEvent.interactable\n    this.timeStamp = dragEvent.timeStamp\n  }\n\n  /**\n   * If this is a `dropactivate` event, the dropzone element will be\n   * deactivated.\n   *\n   * If this is a `dragmove` or `dragenter`, a `dragleave` will be fired on the\n   * dropzone element and more.\n   */\n  reject() {\n    const { dropState } = this._interaction\n\n    if (\n      this.type !== 'dropactivate' &&\n      (!this.dropzone || dropState.cur.dropzone !== this.dropzone || dropState.cur.element !== this.target)\n    ) {\n      return\n    }\n\n    dropState.prev.dropzone = this.dropzone\n    dropState.prev.element = this.target\n\n    dropState.rejected = true\n    dropState.events.enter = null\n\n    this.stopImmediatePropagation()\n\n    if (this.type === 'dropactivate') {\n      const activeDrops = dropState.activeDrops\n      const index = arr.findIndex(\n        activeDrops,\n        ({ dropzone, element }) => dropzone === this.dropzone && element === this.target,\n      )\n\n      dropState.activeDrops.splice(index, 1)\n\n      const deactivateEvent = new DropEvent(dropState, this.dragEvent, 'dropdeactivate')\n\n      deactivateEvent.dropzone = this.dropzone\n      deactivateEvent.target = this.target\n\n      this.dropzone.fire(deactivateEvent)\n    } else {\n      this.dropzone.fire(new DropEvent(dropState, this.dragEvent, 'dragleave'))\n    }\n  }\n\n  preventDefault() {}\n\n  stopPropagation() {\n    this.propagationStopped = true\n  }\n\n  stopImmediatePropagation() {\n    this.immediatePropagationStopped = this.propagationStopped = true\n  }\n}\n"],"names":["DropEvent","BaseEvent","dropzone","dragEvent","relatedTarget","draggable","propagationStopped","immediatePropagationStopped","constructor","dropState","type","_interaction","element","prev","cur","target","currentTarget","interactable","timeStamp","reject","rejected","events","enter","stopImmediatePropagation","activeDrops","index","arr","findIndex","_ref","splice","deactivateEvent","fire","preventDefault","stopPropagation"],"mappings":"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"}