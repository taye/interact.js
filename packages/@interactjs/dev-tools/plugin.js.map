{"version":3,"file":"plugin.js","sources":["plugin.ts"],"sourcesContent":["import type Interaction from '@interactjs/core/Interaction'\nimport type { Scope, Plugin } from '@interactjs/core/scope'\nimport type { Element, OptionMethod } from '@interactjs/core/types'\nimport domObjects from '@interactjs/utils/domObjects'\nimport { parentNode } from '@interactjs/utils/domUtils'\nimport extend from '@interactjs/utils/extend'\nimport is from '@interactjs/utils/is'\nimport isNonNativeEvent from '@interactjs/utils/isNonNativeEvent'\nimport normalizeListeners from '@interactjs/utils/normalizeListeners'\nimport * as win from '@interactjs/utils/window'\n\ndeclare module '@interactjs/core/scope' {\n  interface Scope {\n    logger: Logger\n  }\n}\n\ndeclare module '@interactjs/core/options' {\n  interface BaseDefaults {\n    devTools?: DevToolsOptions\n  }\n}\n\ndeclare module '@interactjs/core/Interactable' {\n  interface Interactable {\n    devTools: OptionMethod<DevToolsOptions>\n  }\n}\n\nexport interface DevToolsOptions {\n  ignore: { [P in keyof typeof CheckName]?: boolean }\n}\n\nexport interface Logger {\n  warn: (...args: any[]) => void\n  error: (...args: any[]) => void\n  log: (...args: any[]) => void\n}\n\nexport interface Check {\n  name: CheckName\n  text: string\n  perform: (interaction: Interaction) => boolean\n  getInfo: (interaction: Interaction) => any[]\n}\n\nenum CheckName {\n  touchAction = 'touchAction',\n  boxSizing = 'boxSizing',\n  noListeners = 'noListeners',\n}\n\nconst prefix = '[interact.js] '\nconst links = {\n  touchAction: 'https://developer.mozilla.org/en-US/docs/Web/CSS/touch-action',\n  boxSizing: 'https://developer.mozilla.org/en-US/docs/Web/CSS/box-sizing',\n}\n\n// eslint-disable-next-line no-undef\nconst isProduction = process.env.NODE_ENV === 'production'\n\nfunction install(scope: Scope, { logger }: { logger?: Logger } = {}) {\n  const { Interactable, defaults } = scope\n\n  scope.logger = logger || console\n\n  defaults.base.devTools = {\n    ignore: {},\n  }\n\n  Interactable.prototype.devTools = function (options?: object) {\n    if (options) {\n      extend(this.options.devTools, options)\n      return this\n    }\n\n    return this.options.devTools\n  }\n\n  // can't set native events on non string targets without `addEventListener` prop\n  const { _onOff } = Interactable.prototype\n  Interactable.prototype._onOff = function (method, typeArg, listenerArg, options, filter) {\n    if (is.string(this.target) || this.target.addEventListener) {\n      return _onOff.call(this, method, typeArg, listenerArg, options, filter)\n    }\n\n    if (is.object(typeArg) && !is.array(typeArg)) {\n      options = listenerArg\n      listenerArg = null\n    }\n\n    const normalizedListeners = normalizeListeners(typeArg, listenerArg, filter)\n\n    for (const type in normalizedListeners) {\n      if (isNonNativeEvent(type, scope.actions)) continue\n      scope.logger.warn(\n        prefix +\n          `Can't add native \"${type}\" event listener to target without \\`addEventListener(type, listener, options)\\` prop.`,\n      )\n    }\n\n    return _onOff.call(this, method, normalizedListeners, options)\n  }\n}\n\nconst checks: Check[] = [\n  {\n    name: CheckName.touchAction,\n    perform({ element }) {\n      return !!element && !parentHasStyle(element, 'touchAction', /pan-|pinch|none/)\n    },\n    getInfo({ element }) {\n      return [element, links.touchAction]\n    },\n    text: 'Consider adding CSS \"touch-action: none\" to this element\\n',\n  },\n\n  {\n    name: CheckName.boxSizing,\n    perform(interaction) {\n      const { element } = interaction\n\n      return (\n        interaction.prepared.name === 'resize' &&\n        element instanceof domObjects.HTMLElement &&\n        !hasStyle(element, 'boxSizing', /border-box/)\n      )\n    },\n    text: 'Consider adding CSS \"box-sizing: border-box\" to this resizable element',\n    getInfo({ element }) {\n      return [element, links.boxSizing]\n    },\n  },\n\n  {\n    name: CheckName.noListeners,\n    perform(interaction) {\n      const actionName = interaction.prepared.name\n      const moveListeners = interaction.interactable?.events.types[`${actionName}move`] || []\n\n      return !moveListeners.length\n    },\n    getInfo(interaction) {\n      return [interaction.prepared.name, interaction.interactable]\n    },\n    text: 'There are no listeners set for this action',\n  },\n]\n\nfunction hasStyle(element: HTMLElement, prop: keyof CSSStyleDeclaration, styleRe: RegExp) {\n  const value = element.style[prop] || win.window.getComputedStyle(element)[prop]\n  return styleRe.test((value || '').toString())\n}\n\nfunction parentHasStyle(element: Element, prop: keyof CSSStyleDeclaration, styleRe: RegExp) {\n  let parent = element as HTMLElement\n\n  while (is.element(parent)) {\n    if (hasStyle(parent, prop, styleRe)) {\n      return true\n    }\n\n    parent = parentNode(parent) as HTMLElement\n  }\n\n  return false\n}\n\nconst id = 'dev-tools'\nconst defaultExport: Plugin = isProduction\n  ? { id, install: () => {} }\n  : {\n      id,\n      install,\n      listeners: {\n        'interactions:action-start': ({ interaction }, scope) => {\n          for (const check of checks) {\n            const options = interaction.interactable && interaction.interactable.options\n\n            if (\n              !(options && options.devTools && options.devTools.ignore[check.name]) &&\n              check.perform(interaction)\n            ) {\n              scope.logger.warn(prefix + check.text, ...check.getInfo(interaction))\n            }\n          }\n        },\n      },\n      checks,\n      CheckName,\n      links,\n      prefix,\n    }\n\nexport default defaultExport\n"],"names":["CheckName","prefix","links","touchAction","boxSizing","install","scope","logger","arguments","length","undefined","Interactable","defaults","console","base","devTools","ignore","prototype","options","extend","_onOff","method","typeArg","listenerArg","filter","is","string","target","addEventListener","call","object","array","normalizedListeners","normalizeListeners","type","isNonNativeEvent","actions","warn","checks","name","perform","_ref","element","parentHasStyle","getInfo","_ref2","text","interaction","prepared","domObjects","HTMLElement","hasStyle","_ref3","noListeners","_interaction$interact","actionName","moveListeners","interactable","events","types","prop","styleRe","value","style","win","window","getComputedStyle","test","toString","parent","parentNode","id","defaultExport","listeners","interactions:action-start","_ref4","check"],"mappings":"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"}