{"version":3,"file":"events.js","sources":["events.ts"],"sourcesContent":["import * as arr from '@interactjs/utils/arr'\nimport * as domUtils from '@interactjs/utils/domUtils'\nimport is from '@interactjs/utils/is'\nimport pExtend from '@interactjs/utils/pointerExtend'\nimport * as pointerUtils from '@interactjs/utils/pointerUtils'\n\nimport type { Scope } from '@interactjs/core/scope'\nimport type { Element } from '@interactjs/core/types'\n\nimport type { NativeEventTarget } from './NativeTypes'\n\ndeclare module '@interactjs/core/scope' {\n  interface Scope {\n    events: ReturnType<typeof install>\n  }\n}\n\ninterface EventOptions {\n  capture: boolean\n  passive: boolean\n}\n\ntype PartialEventTarget = Partial<NativeEventTarget>\n\ntype ListenerEntry = { func: (event: Event | FakeEvent) => any; options: EventOptions }\n\nfunction install(scope: Scope) {\n  const targets: Array<{\n    eventTarget: PartialEventTarget\n    events: { [type: string]: ListenerEntry[] }\n  }> = []\n\n  const delegatedEvents: {\n    [type: string]: Array<{\n      selector: string\n      context: Node\n      listeners: ListenerEntry[]\n    }>\n  } = {}\n  const documents: Document[] = []\n\n  const eventsMethods = {\n    add,\n    remove,\n\n    addDelegate,\n    removeDelegate,\n\n    delegateListener,\n    delegateUseCapture,\n    delegatedEvents,\n    documents,\n\n    targets,\n\n    supportsOptions: false,\n    supportsPassive: false,\n  }\n\n  // check if browser supports passive events and options arg\n  scope.document?.createElement('div').addEventListener('test', null, {\n    get capture() {\n      return (eventsMethods.supportsOptions = true)\n    },\n    get passive() {\n      return (eventsMethods.supportsPassive = true)\n    },\n  })\n\n  scope.events = eventsMethods\n\n  function add(\n    eventTarget: PartialEventTarget,\n    type: string,\n    listener: ListenerEntry['func'],\n    optionalArg?: boolean | EventOptions,\n  ) {\n    if (!eventTarget.addEventListener) return\n\n    const options = getOptions(optionalArg)\n    let target = arr.find(targets, (t) => t.eventTarget === eventTarget)\n\n    if (!target) {\n      target = {\n        eventTarget,\n        events: {},\n      }\n\n      targets.push(target)\n    }\n\n    if (!target.events[type]) {\n      target.events[type] = []\n    }\n\n    if (!arr.find(target.events[type], (l) => l.func === listener && optionsMatch(l.options, options))) {\n      eventTarget.addEventListener(\n        type,\n        listener as any,\n        eventsMethods.supportsOptions ? options : options.capture,\n      )\n      target.events[type].push({ func: listener, options })\n    }\n  }\n\n  function remove(\n    eventTarget: PartialEventTarget,\n    type: string,\n    listener?: 'all' | ListenerEntry['func'],\n    optionalArg?: boolean | EventOptions,\n  ) {\n    if (!eventTarget.addEventListener || !eventTarget.removeEventListener) return\n\n    const targetIndex = arr.findIndex(targets, (t) => t.eventTarget === eventTarget)\n    const target = targets[targetIndex]\n\n    if (!target || !target.events) {\n      return\n    }\n\n    if (type === 'all') {\n      for (type in target.events) {\n        if (target.events.hasOwnProperty(type)) {\n          remove(eventTarget, type, 'all')\n        }\n      }\n      return\n    }\n\n    let typeIsEmpty = false\n    const typeListeners = target.events[type]\n\n    if (typeListeners) {\n      if (listener === 'all') {\n        for (let i = typeListeners.length - 1; i >= 0; i--) {\n          const entry = typeListeners[i]\n          remove(eventTarget, type, entry.func, entry.options)\n        }\n        return\n      } else {\n        const options = getOptions(optionalArg)\n\n        for (let i = 0; i < typeListeners.length; i++) {\n          const entry = typeListeners[i]\n          if (entry.func === listener && optionsMatch(entry.options, options)) {\n            eventTarget.removeEventListener(\n              type,\n              listener as any,\n              eventsMethods.supportsOptions ? options : options.capture,\n            )\n            typeListeners.splice(i, 1)\n\n            if (typeListeners.length === 0) {\n              delete target.events[type]\n              typeIsEmpty = true\n            }\n\n            break\n          }\n        }\n      }\n    }\n\n    if (typeIsEmpty && !Object.keys(target.events).length) {\n      targets.splice(targetIndex, 1)\n    }\n  }\n\n  function addDelegate(\n    selector: string,\n    context: Node,\n    type: string,\n    listener: ListenerEntry['func'],\n    optionalArg?: any,\n  ) {\n    const options = getOptions(optionalArg)\n    if (!delegatedEvents[type]) {\n      delegatedEvents[type] = []\n\n      // add delegate listener functions\n      for (const doc of documents) {\n        add(doc, type, delegateListener)\n        add(doc, type, delegateUseCapture, true)\n      }\n    }\n\n    const delegates = delegatedEvents[type]\n    let delegate = arr.find(delegates, (d) => d.selector === selector && d.context === context)\n\n    if (!delegate) {\n      delegate = { selector, context, listeners: [] }\n      delegates.push(delegate)\n    }\n\n    delegate.listeners.push({ func: listener, options })\n  }\n\n  function removeDelegate(\n    selector: string,\n    context: Document | Element,\n    type: string,\n    listener?: ListenerEntry['func'],\n    optionalArg?: any,\n  ) {\n    const options = getOptions(optionalArg)\n    const delegates = delegatedEvents[type]\n    let matchFound = false\n    let index: number\n\n    if (!delegates) return\n\n    // count from last index of delegated to 0\n    for (index = delegates.length - 1; index >= 0; index--) {\n      const cur = delegates[index]\n      // look for matching selector and context Node\n      if (cur.selector === selector && cur.context === context) {\n        const { listeners } = cur\n\n        // each item of the listeners array is an array: [function, capture, passive]\n        for (let i = listeners.length - 1; i >= 0; i--) {\n          const entry = listeners[i]\n\n          // check if the listener functions and capture and passive flags match\n          if (entry.func === listener && optionsMatch(entry.options, options)) {\n            // remove the listener from the array of listeners\n            listeners.splice(i, 1)\n\n            // if all listeners for this target have been removed\n            // remove the target from the delegates array\n            if (!listeners.length) {\n              delegates.splice(index, 1)\n\n              // remove delegate function from context\n              remove(context, type, delegateListener)\n              remove(context, type, delegateUseCapture, true)\n            }\n\n            // only remove one listener\n            matchFound = true\n            break\n          }\n        }\n\n        if (matchFound) {\n          break\n        }\n      }\n    }\n  }\n\n  // bound to the interactable context when a DOM event\n  // listener is added to a selector interactable\n  function delegateListener(event: Event | FakeEvent, optionalArg?: any) {\n    const options = getOptions(optionalArg)\n    const fakeEvent = new FakeEvent(event as Event)\n    const delegates = delegatedEvents[event.type]\n    const [eventTarget] = pointerUtils.getEventTargets(event as Event)\n    let element: Node = eventTarget\n\n    // climb up document tree looking for selector matches\n    while (is.element(element)) {\n      for (let i = 0; i < delegates.length; i++) {\n        const cur = delegates[i]\n        const { selector, context } = cur\n\n        if (\n          domUtils.matchesSelector(element, selector) &&\n          domUtils.nodeContains(context, eventTarget) &&\n          domUtils.nodeContains(context, element)\n        ) {\n          const { listeners } = cur\n\n          fakeEvent.currentTarget = element\n\n          for (const entry of listeners) {\n            if (optionsMatch(entry.options, options)) {\n              entry.func(fakeEvent)\n            }\n          }\n        }\n      }\n\n      element = domUtils.parentNode(element)\n    }\n  }\n\n  function delegateUseCapture(this: Element, event: Event | FakeEvent) {\n    return delegateListener.call(this, event, true)\n  }\n\n  // for type inferrence\n  return eventsMethods\n}\n\nclass FakeEvent implements Partial<Event> {\n  currentTarget: Node\n  originalEvent: Event\n  type: string\n\n  constructor(originalEvent: Event) {\n    this.originalEvent = originalEvent\n    // duplicate the event so that currentTarget can be changed\n    pExtend(this, originalEvent)\n  }\n\n  preventOriginalDefault() {\n    this.originalEvent.preventDefault()\n  }\n\n  stopPropagation() {\n    this.originalEvent.stopPropagation()\n  }\n\n  stopImmediatePropagation() {\n    this.originalEvent.stopImmediatePropagation()\n  }\n}\n\nfunction getOptions(param: { [index: string]: any } | boolean): { capture: boolean; passive: boolean } {\n  if (!is.object(param)) {\n    return { capture: !!param, passive: false }\n  }\n\n  return {\n    capture: !!param.capture,\n    passive: !!param.passive,\n  }\n}\n\nfunction optionsMatch(a: Partial<EventOptions> | boolean, b: Partial<EventOptions>) {\n  if (a === b) return true\n\n  if (typeof a === 'boolean') return !!b.capture === a && !!b.passive === false\n\n  return !!a.capture === !!b.capture && !!a.passive === !!b.passive\n}\n\nexport default {\n  id: 'events',\n  install,\n}\n"],"names":["install","scope","_scope$document","targets","delegatedEvents","documents","eventsMethods","add","remove","addDelegate","removeDelegate","delegateListener","delegateUseCapture","supportsOptions","supportsPassive","document","createElement","addEventListener","capture","passive","events","eventTarget","type","listener","optionalArg","options","getOptions","target","arr","find","t","push","l","func","optionsMatch","removeEventListener","targetIndex","findIndex","hasOwnProperty","typeIsEmpty","typeListeners","i","length","entry","splice","Object","keys","selector","context","doc","delegates","delegate","d","listeners","matchFound","index","cur","event","fakeEvent","FakeEvent","pointerUtils","getEventTargets","element","is","domUtils","matchesSelector","nodeContains","currentTarget","parentNode","call","originalEvent","constructor","pExtend","preventOriginalDefault","preventDefault","stopPropagation","stopImmediatePropagation","param","object","a","b","id"],"mappings":"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"}